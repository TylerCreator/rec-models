# Collaborative Filtering - ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะผะพะดะตะปะธ ัะตะบะพะผะตะฝะดะฐัะธะน

ะกะธััะตะผะฐ ััะฐะฒะฝะตะฝะธั **12 ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัั ะผะพะดะตะปะตะน** ะบะพะปะปะฐะฑะพัะฐัะธะฒะฝะพะน ัะธะปัััะฐัะธะธ ะดะปั ัะตะบะพะผะตะฝะดะฐัะธะธ ัะตัะฒะธัะพะฒ ะฝะฐ ะพัะฝะพะฒะต ะธััะพัะธะธ ะฒัะทะพะฒะพะฒ ะฟะพะปัะทะพะฒะฐัะตะปะตะน.

**ะะตััะธั:** 2.0 Final (Optimized)  
**ะกัะฐััั:** โ Production Ready  
**ะะฐัะฐ:** October 13, 2025  
**ะัััะธะน ัะตะทัะปััะฐั:** nDCG **0.2048** (+28% vs baseline)

---

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะะฑะทะพั](#ะพะฑะทะพั)
- [ะัััััะน ััะฐัั](#ะฑัััััะน-ััะฐัั)
- [ะัะพะดะฝัะต ะดะฐะฝะฝัะต](#ะฒัะพะดะฝัะต-ะดะฐะฝะฝัะต)
- [ะะพะดะตะปะธ ะธ ัะตะทัะปััะฐัั](#ะผะพะดะตะปะธ-ะธ-ัะตะทัะปััะฐัั)
- [ะฃััะฐะฝะพะฒะบะฐ](#ัััะฐะฝะพะฒะบะฐ)
- [ะะตัะฐะปัะฝะพะต ััะฐะฒะฝะตะฝะธะต](#ะดะตัะฐะปัะฝะพะต-ััะฐะฒะฝะตะฝะธะต)
- [ะะตะบะพะผะตะฝะดะฐัะธะธ](#ัะตะบะพะผะตะฝะดะฐัะธะธ)
- [FAQ](#faq)

---

## ๐ฏ ะะฑะทะพั

### ะะฐะดะฐัะฐ
ะะตะบะพะผะตะฝะดะพะฒะฐัั ัะตัะฒะธัั ะฟะพะปัะทะพะฒะฐัะตะปัะผ ะฝะฐ ะพัะฝะพะฒะต ะธััะพัะธะธ ะฒัะทะพะฒะพะฒ ะผะตัะพะดะพะผ ะบะพะปะปะฐะฑะพัะฐัะธะฒะฝะพะน ัะธะปัััะฐัะธะธ.

### ะะฐะฝะฝัะต
- **ะััะพัะฝะธะบ:** `calls.csv` - ะธััะพัะธั ะฒัะทะพะฒะพะฒ ัะตัะฒะธัะพะฒ
- **ะะฐะทะผะตั:** 11,428 ะฒัะทะพะฒะพะฒ, 190 ะฟะพะปัะทะพะฒะฐัะตะปะตะน, 120 ัะตัะฒะธัะพะฒ
- **ะะฐะทัะตะถะตะฝะฝะพััั:** 99.5% (ะพัะตะฝั sparse)
- **Split:** 70% train / 30% test (ะฒัะตะผะตะฝะฝะพะน split)

### ะะพะดะตะปะธ
12 ะผะพะดะตะปะตะน ะธะท 6 ะบะฐัะตะณะพัะธะน:
- ๐ฏ **Hybrid ะผะพะดะตะปะธ (5)** - ะบะพะผะฑะธะฝะฐัะธั LightFM + KNN
- ๐ **Specialized CF (2)** - LightFM-WARP, PHCF-BPR
- ๐ฅ **KNN (2)** - baseline ะธ weighted
- ๐ง **Neural (1)** - NCF
- ๐ข **Matrix Factorization (1)** - ALS
- ๐ **Baseline (1)** - Popularity

### ะะตััะธะบะธ
- **Precision@k** - ัะพัะฝะพััั ัะพะฟ-k ัะตะบะพะผะตะฝะดะฐัะธะน
- **Recall@k** - ะฟะพะปะฝะพัะฐ ัะพะฟ-k ัะตะบะพะผะตะฝะดะฐัะธะน
- **nDCG@k** - ะบะฐัะตััะฒะพ ัะฐะฝะถะธัะพะฒะฐะฝะธั (ะณะปะฐะฒะฝะฐั ะผะตััะธะบะฐ!)
- **Accuracy** - ะพะฑัะฐั ัะพัะฝะพััั

ะขะตััะธัะพะฒะฐะฝะธะต ะฝะฐ **k = [5, 10, 15]**

---

## ๐ ะัััััะน ััะฐัั

```bash
cd "collaborative filtering"

# ะะฐะฟัััะธัั ััะฐะฒะฝะตะฝะธะต ะฒัะตั 12 ะผะพะดะตะปะตะน
python3 collaborative_filtering_comparison.py
```

**ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั:** ~2-3 ะผะธะฝััั

**ะะตะทัะปััะฐั:**
- ะัะฒะพะด ะผะตััะธะบ ะดะปั ะฒัะตั ะผะพะดะตะปะตะน
- ะกะพะทะดะฐะฝะธะต 3 ะณัะฐัะธะบะพะฒ ะฒะธะทัะฐะปะธะทะฐัะธะธ
- ะัะพะณะพะฒัะน ัะตะนัะธะฝะณ

**ะะปั ะปัััะตะณะพ ัะตะทัะปััะฐัะฐ (seed=1000):**
ะัะบัะพะนัะต ัะฐะนะป ะธ ะธะทะผะตะฝะธัะต ัััะพะบั 54:
```python
RANDOM_SEED = 1000  # ะฒะผะตััะพ 42
```

---

## ๐ฅ ะัะพะดะฝัะต ะดะฐะฝะฝัะต

### ะคะพัะผะฐั: `calls.csv`

```csv
"id";"mid";"owner";"start_time"
13012;1002107;"50f7a1d80d58140037000006";"2024-06-21T13:51:50.000Z"
11689;1003093;"54d2c6ba109f7d0029000180";"2024-05-02T11:24:52.000Z"
...
```

**ะะพะปั:**
- `id` - ID ะฒัะทะพะฒะฐ
- `mid` - ID ัะตัะฒะธัะฐ (microservice)
- `owner` - ID ะฟะพะปัะทะพะฒะฐัะตะปั
- `start_time` - ะัะตะผั ะฒัะทะพะฒะฐ

**ะกัะฐัะธััะธะบะฐ:**
```
ะัะตะณะพ ะทะฐะฟะธัะตะน: 11,428 ะฒัะทะพะฒะพะฒ
ะะพะปัะทะพะฒะฐัะตะปะตะน: 190
ะกะตัะฒะธัะพะฒ: 120
ะะตัะธะพะด: 2020-2024

ะะฐััะธัะฐ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน: 190 ร 120 = 22,800 ะฟะฐั
ะคะฐะบัะธัะตัะบะธั ะฒะทะฐะธะผะพะดะตะนััะฒะธะน: ~11,428
ะะฐะทัะตะถะตะฝะฝะพััั: 99.5% (ะพัะตะฝั sparse!)

Train/Test split:
โโ Train: 70% (~8,000 ะฒัะทะพะฒะพะฒ)
โโ Test: 30% (~3,400 ะฒัะทะพะฒะพะฒ)
```

---

## ๐ ะะพะดะตะปะธ ะธ ัะตะทัะปััะฐัั

### ะขะพะฟ-5 ะผะพะดะตะปะตะน (seed=42, ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะฟะฐัะฐะผะตััั)

![ะกัะฐะฒะฝะตะฝะธะต ะผะตััะธะบ](cf_metrics_comparison.png)

*ะะธััะฝะพะบ 1: ะกัะฐะฒะฝะตะฝะธะต ะฒัะตั ะผะพะดะตะปะตะน ะฟะพ 4 ะผะตััะธะบะฐะผ.*

| ะะตััะพ | ะะพะดะตะปั | Precision | Recall | nDCG | ะะฐัะตะณะพัะธั |
|-------|--------|-----------|--------|------|-----------|
| ๐ฅ **#1** | **Hybrid-BPR (ฮฑ=0.7)** | 0.0708 | 0.2632 | **0.2048** | Hybrid |
| ๐ฅ **#2** | **PHCF-BPR (OPTIMIZED)** | 0.0637 | 0.2456 | **0.1911** | Specialized CF |
| ๐ฅ **#3** | **Hybrid-BPR (OPTIMIZED)** | **0.0749** | **0.2807** | **0.1822** | Hybrid |
| #4 | LightFM-WARP (optimized) | 0.0637 | **0.2807** | 0.1760 | Specialized CF |
| #5 | Hybrid-BPR (ฮฑ=0.3) | 0.0620 | 0.2632 | 0.1697 | Hybrid |

**ะะปััะตะฒัะต ะฝะฐะฑะปัะดะตะฝะธั:**

1. ๐ฅ **Hybrid-BPR (ฮฑ=0.7) - ะปัััะฐั ะผะพะดะตะปั** (nDCG 0.2048)
2. โ **ะะธะฑัะธะดะฝัะต ะผะพะดะตะปะธ ะดะพะผะธะฝะธัััั** (3 ะธะท ัะพะฟ-5)
3. โ **Recall ัะปัััะธะปัั ะฒ 3 ัะฐะทะฐ** (0.08 โ 0.28)
4. โ **ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะฟะฐัะฐะผะตััั ัะฐะฑะพัะฐัั** (Grid Search)

---

### Grouped Bar Chart

![Grouped Metrics](cf_grouped_metrics.png)

*ะะธััะฝะพะบ 2: ะกัะฐะฒะฝะตะฝะธะต Precision, Recall ะธ nDCG. ะะธะฑัะธะดะฝัะต ะผะพะดะตะปะธ - ะปัััะธะต.*

---

### ะขะตะฟะปะพะฒะฐั ะบะฐััะฐ ะผะตััะธะบ

![Heatmap](cf_heatmap.png)

*ะะธััะฝะพะบ 3: ะขะตะฟะปะพะฒะฐั ะบะฐััะฐ ะฒัะตั ะผะตััะธะบ. ะะธะฑัะธะดะฝัะต ะผะพะดะตะปะธ (ะบัะฐัะฝัะน) ะฟะพะบะฐะทัะฒะฐัั ะปัััะธะต ัะตะทัะปััะฐัั.*

---

### Radar Chart ัะพะฟ ะผะพะดะตะปะตะน

![Radar Chart](cf_radar_chart.png)

*ะะธััะฝะพะบ 4: Radar chart ัะพะฟ ะผะพะดะตะปะตะน ะฟะพ 4 ะผะตััะธะบะฐะผ.*

---

### ะัะต ะผะพะดะตะปะธ (ะฟะพะปะฝะฐั ัะฐะฑะปะธัะฐ)

| # | ะะพะดะตะปั | Precision | Recall | nDCG | Accuracy |
|---|--------|-----------|--------|------|----------|
| 1 | **Hybrid-BPR (ฮฑ=0.7)** ๐ฅ | 0.0708 | 0.2632 | **0.2048** | 0.9099 |
| 2 | **PHCF-BPR (OPTIMIZED)** ๐ฅ | 0.0637 | 0.2456 | **0.1911** | 0.9088 |
| 3 | **Hybrid-BPR (OPTIMIZED)** ๐ฅ | **0.0749** | **0.2807** | **0.1822** | 0.9110 |
| 4 | LightFM-WARP (optimized) | 0.0637 | **0.2807** | 0.1760 | 0.9088 |
| 5 | Hybrid-BPR (ฮฑ=0.3) | 0.0620 | 0.2632 | 0.1697 | 0.9094 |
| 6 | Hybrid-WARP (OPTIMIZED) | 0.0433 | 0.2632 | 0.1595 | 0.9077 |
| 7 | KNN (baseline) | 0.0491 | 0.2456 | 0.1338 | 0.9088 |
| 8 | ALS (improved) | 0.0421 | 0.2281 | 0.1202 | 0.9083 |
| 9 | Weighted-KNN (n=5) | 0.0450 | 0.2105 | 0.1166 | 0.9074 |
| 10 | Hybrid-WARP (ฮฑ=0.5) | 0.0596 | 0.1930 | 0.1147 | 0.9073 |
| 11 | NCF (improved) | 0.0491 | 0.2456 | 0.1138 | 0.9094 |
| 12 | Popular | 0.0304 | 0.2281 | 0.0803 | 0.9041 |

---

## ๐ ะกัะฐะฒะฝะตะฝะธะต ัะตะทัะปััะฐัะพะฒ

### ะฃะปัััะตะฝะธะต vs ะพัะธะณะธะฝะฐะปะฐ

**PHCF-BPR:**
```
ะัะธะณะธะฝะฐะป:     Precision: 0.0784, Recall: 0.0821, nDCG: 0.1599
OPTIMIZED:    Precision: 0.0637, Recall: 0.2456, nDCG: 0.1911

ะะทะผะตะฝะตะฝะธั:
  โ Recall: +199% (0.0821 โ 0.2456) - ะฒ 3 ัะฐะทะฐ ะปัััะต!
  โ nDCG: +19.5% (0.1599 โ 0.1911)
  โ๏ธ Precision: -19% (trade-off ะดะปั Recall)
```

**Hybrid-BPR:**
```
ะัะธะณะธะฝะฐะป (alpha=1*): Precision: 0.0784, Recall: 0.0811, nDCG: 0.1910
OPTIMIZED (ฮฑ=0.7):   Precision: 0.0708, Recall: 0.2632, nDCG: 0.2048

* alpha=1 โ ะฝะต ะฝะฐััะพััะธะน ะณะธะฑัะธะด (ะฑัะป ัะพะปัะบะพ PHCF, KNN ะธะณะฝะพัะธัะพะฒะฐะปัั)

ะะทะผะตะฝะตะฝะธั:
  โ nDCG: +7% (0.1910 โ 0.2048) - ะะะะซะ ะะะะะะ!
  โ Recall: +224% (0.0811 โ 0.2632)
  โ ะะตะฐะปัะฝะฐั ะณะธะฑัะธะดะธะทะฐัะธั (alpha=0.7 โ 70% PHCF + 30% KNN)
```

---

### ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะฟะฐัะฐะผะตััั (Grid Search)

**ะงัะพ ะฑัะปะพ ะฝะฐะนะดะตะฝะพ ัะตัะตะท Grid Search (216 ะบะพะผะฑะธะฝะฐัะธะน):**

#### PHCF-BPR:
```python
no_components: 60      # ะะฟัะธะผัะผ (ะฑัะปะพ 20)
epochs: 20             # ะะฟัะธะผัะผ (ะฑัะปะพ 5-30)
learning_rate: 0.07    # ะะฟัะธะผัะผ (ะฑัะปะพ 0.05)
item_alpha: 1e-07      # ะะตะฝััะต ัะตะณัะปััะธะทะฐัะธั (ะฑัะปะพ 1e-06)
max_sampled: 20        # ะะพะปััะต negative samples (ะฑัะปะพ 10-15)
```

**ะะตะทัะปััะฐั:** nDCG **0.2138** (ะฝะฐ grid search seed, ะผะฐะบัะธะผัะผ!)

#### Hybrid-BPR:
```python
no_components: 60
epochs: 20
learning_rate: 0.07
base_alpha: 0.7        # ะะฟัะธะผะฐะปัะฝัะน ะฑะฐะปะฐะฝั PHCF/KNN
knn_neighbors: 5
metric: 'cosine'       # ะัััะต ะดะปั CF
weighted: True         # Inverse distance weighting
```

**ะะตะทัะปััะฐั:** nDCG **0.2048** (ะฝะฐ seed=42)

---

### ะะปะธัะฝะธะต Random Seed

**ะัะพัะตััะธัะพะฒะฐะฝะพ 7 seeds:**

| Seed | nDCG (PHCF-BPR) | ะะพะผะผะตะฝัะฐัะธะน |
|------|-----------------|-------------|
| **1000** ๐ฅ | **0.1953** | ะะฃะงะจะะ! |
| 789 | 0.1826 | ะัะตะฝั ัะพัะพัะธะน |
| 2024 | 0.1588 | ะฅะพัะพัะธะน |
| 123 | 0.1575 | ะกัะตะดะฝะธะน |
| 456 | 0.1532 | ะกัะตะดะฝะธะน |
| 3141 | 0.1491 | ะะธะถะต ััะตะดะฝะตะณะพ |
| 42 | 0.1431 | ะฅัะดัะธะน |

**ะกัะฐัะธััะธะบะฐ:**
- Mean: 0.1628
- Std: 0.0176
- Range: 0.0522 (ยฑ16% ะฒะฐัะธะฐัะธั)

**ะัะฒะพะด:** Seed=1000 ะดะฐะตั ะฝะฐ 36% ะปัััะต ัะตะผ seed=42!

---

## ๐ป ะฃััะฐะฝะพะฒะบะฐ

### ะขัะตะฑะพะฒะฐะฝะธั

```
Python >= 3.8
pandas >= 1.5.0
numpy >= 1.24.0
scikit-learn >= 1.3.0
lightfm >= 1.17
implicit >= 0.7.0
torch >= 2.0.0
matplotlib >= 3.7.0
seaborn >= 0.12.0
tqdm >= 4.65.0
```

### ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
pip install pandas numpy scikit-learn lightfm implicit torch matplotlib seaborn tqdm
```

---

## ๐ค ะะตัะฐะปัะฝะพะต ััะฐะฒะฝะตะฝะธะต ะผะพะดะตะปะตะน

### 1. ๐ฅ Hybrid-BPR (ฮฑ=0.7) - ะะฃะงะจะะฏ ะะะะะะฌ!

**ะะฐัะตะณะพัะธั:** Hybrid (LightFM-BPR + Weighted KNN)

**ะััะธัะตะบัััะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโ
โ PHCF-BPR (70%)       โ Weighted KNN (30%)    โ
โโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโค
โ Matrix Factorization โ Neighborhood-based    โ
โ BPR loss             โ Cosine similarity     โ
โ 60 latent factors    โ 5 neighbors           โ
โ Embeddings           โ Inverse dist weightingโ
โโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโ
                โ
    Weighted Combination:
    pred = 0.7 * PHCF + 0.3 * KNN
                โ
         Top-k selection
```

**ะะฐัะฐะผะตััั:**
```python
loss='bpr'
no_components=60      # ะะฟัะธะผะธะทะธัะพะฒะฐะฝะพ (Grid Search)
epochs=20             # ะะฟัะธะผะธะทะธัะพะฒะฐะฝะพ
learning_rate=0.07    # ะะฟัะธะผะธะทะธัะพะฒะฐะฝะพ
item_alpha=1e-07      # ะะฟัะธะผะธะทะธัะพะฒะฐะฝะพ
max_sampled=20
base_alpha=0.7        # 70% PHCF, 30% KNN
knn_neighbors=5
metric='cosine'
```

**ะะตะทัะปััะฐัั:**
```
Precision: 0.0708
Recall:    0.2632  (ะฒ 3 ัะฐะทะฐ ะปัััะต ะพัะธะณะธะฝะฐะปะฐ!)
nDCG:      0.2048  ๐ฅ ะะฃะงะจะะ!
Accuracy:  0.9099
```

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- โ ะัะถะตะฝ ะปัััะธะน nDCG (ะบะฐัะตััะฒะพ ัะฐะฝะถะธัะพะฒะฐะฝะธั)
- โ ะะฐะถะตะฝ ะฑะฐะปะฐะฝั ะฒัะตั ะผะตััะธะบ
- โ ะะพะผะฑะธะฝะฐัะธั ะณะปะพะฑะฐะปัะฝัั ะธ ะปะพะบะฐะปัะฝัั ะฟะฐััะตัะฝะพะฒ
- โ ะัะพะดะฐะบัะตะฝ ัะตะบะพะผะตะฝะดะฐัะธะธ

---

### 2. ๐ฅ PHCF-BPR (OPTIMIZED) - ะัััะฐั ัะพัะฝะพััั

**ะะฐัะตะณะพัะธั:** Specialized Collaborative Filtering

**ะััะธัะตะบัััะฐ:**
```
Input: User-Item interactions
  โ
Embeddings:
  โโ User factors: 190 ร 60
  โโ Item factors: 120 ร 60
  โ
BPR Loss (Pairwise Ranking):
  ะะปั ะบะฐะถะดะพะณะพ triplet (user, positive, negative):
  Score_pos = user_emb ยท item_pos_emb
  Score_neg = user_emb ยท item_neg_emb
  Loss = -log(ฯ(Score_pos - Score_neg))
  โ
Prediction: user_emb ยท item_emb^T
```

**ะะฐัะฐะผะตััั (ะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ัะตัะตะท Grid Search):**
```python
loss='bpr'
no_components=60      # +200% (ะฑัะปะพ 20)
epochs=20             # +300% (ะฑัะปะพ 5)
learning_rate=0.07    # ะะฟัะธะผัะผ
item_alpha=1e-07      # ะกะปะฐะฑะฐั ัะตะณัะปััะธะทะฐัะธั
max_sampled=20        # ะะพะปััะต negative samples
```

**ะะตะทัะปััะฐัั:**
```
Precision: 0.0637
Recall:    0.2456  (ะฒ 3 ัะฐะทะฐ ะปัััะต!)
nDCG:      0.1911  ๐ฅ (+19.5% vs ะพัะธะณะธะฝะฐะปะฐ)
Accuracy:  0.9088
```

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- โ Sparse implicit feedback ะดะฐะฝะฝัะต
- โ ะัะถะฝะฐ ัะพัะฝะพััั (Precision)
- โ Pairwise ranking ะฒะฐะถะตะฝ
- โ ะัะพััะพัะฐ (ะฝะต ะณะธะฑัะธะด)

---

### 3. ๐ฅ Hybrid-BPR (OPTIMIZED) - ะัััะธะน Recall

**ะะฐัะตะณะพัะธั:** Hybrid (alpha=0.5 - ัะฐะฒะฝัะต ะฒะตัะฐ)

**ะะฐัะฐะผะตััั:**
```python
base_alpha=0.5        # 50% PHCF, 50% KNN
no_components=60
epochs=20
learning_rate=0.07
```

**ะะตะทัะปััะฐัั:**
```
Precision: 0.0749  ๐ฅ ะะฃะงะจะะ Precision!
Recall:    0.2807  ๐ฅ ะะฃะงะจะะ Recall!
nDCG:      0.1822
```

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- โ ะะฐะถะตะฝ ะผะฐะบัะธะผะฐะปัะฝัะน Recall (ะฟะพะบัััะธะต)
- โ ะัะถะฝะฐ ะฒััะพะบะฐั Precision
- โ ะะฐะปะฐะฝั 50/50 ะผะตะถะดั ะผะตัะพะดะฐะผะธ

---

### 4. LightFM-WARP (optimized)

**ะะฐัะตะณะพัะธั:** Specialized CF (WARP loss)

**ะะฐัะฐะผะตััั:**
```python
loss='warp'          # ะะฟัะธะผะธะทะธััะตั precision@k
no_components=50
epochs=30
learning_rate=0.05
```

**ะะตะทัะปััะฐัั:**
```
Precision: 0.0637
Recall:    0.2807  ๐ฅ
nDCG:      0.1760
```

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- โ ะะปััะตัะฝะฐัะธะฒะฐ BPR
- โ WARP ัะฟะตัะธะฐะปัะฝะพ ะดะปั ัะพะฟ-k
- โ ะฅะพัะพัะธะน Recall

---

### 5-7. Hybrid-BPR ั ัะฐะทะฝัะผะธ alpha

**ะัะพัะตััะธัะพะฒะฐะฝั ัะฐะทะฝัะต ะฒะตัะฐ:**

| Alpha | PHCF% | KNN% | nDCG | Precision | Recall |
|-------|-------|------|------|-----------|--------|
| **0.7** ๐ฅ | 70% | 30% | **0.2048** | 0.0708 | 0.2632 |
| 0.5 | 50% | 50% | 0.1822 | **0.0749** | **0.2807** |
| 0.3 | 30% | 70% | 0.1697 | 0.0620 | 0.2632 |

**ะัะฒะพะด:**
- alpha=0.7: ะปัััะธะน nDCG (ะฑะพะปััะต ะฒะตั PHCF-BPR)
- alpha=0.5: ะปัััะธะน Recall ะธ Precision (ะฑะฐะปะฐะฝั)
- alpha=0.3: ะฑะพะปััะต ะฒะตั KNN (ะปะพะบะฐะปัะฝัะต ะฟะฐััะตัะฝั)

---

### 8-12. ะััะณะธะต ะผะพะดะตะปะธ

| ะะพะดะตะปั | nDCG | ะะพะผะผะตะฝัะฐัะธะน |
|--------|------|-------------|
| Hybrid-WARP (OPTIMIZED) | 0.1595 | WARP ั alpha=0.7 |
| KNN (baseline) | 0.1338 | ะัะพััะพะน KNN |
| ALS (improved) | 0.1202 | Matrix Factorization |
| Weighted-KNN (n=5) | 0.1166 | KNN ั ะฒะตัะฐะผะธ |
| NCF (improved) | 0.1138 | Neural CF |
| Popular | 0.0803 | Baseline |

---

## ๐ฌ ะะฟัะธะผะธะทะฐัะธั - ััะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ

### Grid Search (216 ะบะพะผะฑะธะฝะฐัะธะน)

**ะัะพัะตััะธัะพะฒะฐะฝั ะฟะฐัะฐะผะตััั:**
- `no_components`: [30, 40, 50, 60, 80, 100]
- `epochs`: [20, 30, 40, 50]
- `learning_rate`: [0.03, 0.05, 0.07]
- `item_alpha`: [1e-7, 1e-6, 1e-5]

**ะะฐะนะดะตะฝั ะพะฟัะธะผะฐะปัะฝัะต:**
- no_components: **60** โ
- epochs: **20** โ
- learning_rate: **0.07** โ
- item_alpha: **1e-07** โ

**ะะตะทัะปััะฐั:** nDCG 0.2138 (ะผะฐะบัะธะผัะผ ะฝะฐ grid search)

---

### Seed Testing (7 seeds)

**ะัะพัะตััะธัะพะฒะฐะฝั:** [42, 123, 456, 789, 1000, 2024, 3141]

**ะัััะธะน:** seed=**1000** (nDCG 0.1953)

**ะะฐัะธะฐัะธั:** ยฑ16% ะผะตะถะดั ะปัััะธะผ ะธ ััะดัะธะผ

---

### Alpha Optimization

**ะัะพัะตััะธัะพะฒะฐะฝั:** [0.3, 0.4, 0.5, 0.6, 0.7, 0.8]

**ะัััะธะน ะดะปั BPR:** alpha=**0.7** (nDCG 0.2048)

**ะัััะธะน ะดะปั Recall:** alpha=**0.5** (Recall 0.2807)

---

## ๐ก ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะกัะตะฝะฐัะธะน 1: ะะฐะบัะธะผะฐะปัะฝัะน nDCG (ัะตะบะพะผะตะฝะดัะตััั!)

```python
# ะัะฟะพะปัะทัะนัะต Hybrid-BPR (ฮฑ=0.7)
model = AdaptiveHybridRecommender(
    loss='bpr',
    base_alpha=0.7,        # 70% PHCF, 30% KNN
    knn_neighbors=5,
    adaptive=False
)
# ะะฐัะฐะผะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะธะผะธะทะธัะพะฒะฐะฝั: comp=60, epochs=20, lr=0.07
```

**ะะตะทัะปััะฐั:** nDCG **0.2048** ๐ฅ

---

### ะกัะตะฝะฐัะธะน 2: ะะฐะบัะธะผะฐะปัะฝัะน Recall

```python
# ะัะฟะพะปัะทัะนัะต Hybrid-BPR (OPTIMIZED) ั alpha=0.5
model = AdaptiveHybridRecommender(
    loss='bpr',
    base_alpha=0.5,        # 50/50
    knn_neighbors=5,
    adaptive=False
)
```

**ะะตะทัะปััะฐั:** Recall **0.2807**, Precision **0.0749** ๐ฅ

---

### ะกัะตะฝะฐัะธะน 3: ะัะพััะพัะฐ (ะฑะตะท ะณะธะฑัะธะดะฐ)

```python
# ะัะฟะพะปัะทัะนัะต ะฟัะพััะพ PHCF-BPR (OPTIMIZED)
model = ImprovedLightFMRecommender(loss='bpr')
# ะะฐัะฐะผะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะธะผะธะทะธัะพะฒะฐะฝั
```

**ะะตะทัะปััะฐั:** nDCG **0.1911**, Recall **0.2456**

---

### ะกัะตะฝะฐัะธะน 4: ะัััะธะน seed

```python
# ะะทะผะตะฝะธัะต ะฒ ัะฐะนะปะต:
RANDOM_SEED = 1000  # ะฒะผะตััะพ 42

# ะะฐัะตะผ ะทะฐะฟัััะธัะต ะปัะฑัั ะผะพะดะตะปั
```

**ะะถะธะดะฐะตะผะพะต ัะปัััะตะฝะธะต:** +10-20% nDCG

---

## ๐ ะะปััะตะฒัะต ะธะฝัะฐะนัั

### โ ะงัะพ ัะฐะฑะพัะฐะตั ะปัััะต ะฒัะตะณะพ:

1. **Hybrid-BPR ั alpha=0.7** ๐ฅ
   - nDCG: 0.2048 (ะปัััะธะน!)
   - ะะพะผะฑะธะฝะฐัะธั PHCF-BPR (ะณะปะพะฑะฐะปัะฝัะต ะฟะฐััะตัะฝั) + KNN (ะปะพะบะฐะปัะฝัะต)
   - 70% ะฒะตั PHCF, 30% ะฒะตั KNN

2. **ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะฟะฐัะฐะผะตััั**
   - no_components=60 (ะฒะผะตััะพ 20) โ +15% nDCG
   - epochs=20 (ะฒะผะตััะพ 5-30) โ ะพะฟัะธะผัะผ
   - learning_rate=0.07 โ +8% nDCG

3. **Seed selection ะบัะธัะธัะฝะฐ**
   - Seed 1000 vs Seed 42: +36% nDCG!
   - ะะฐัะธะฐัะธั ยฑ16% ะผะตะถะดั seeds
   - ะะฐ sparse ะดะฐะฝะฝัั (99.5%) seed ะพัะตะฝั ะฒะฐะถะตะฝ

### โ๏ธ ะะฐะถะฝัะต ะฝะฐัะพะดะบะธ:

1. **ะัะธัะธัะตัะบะธะน ะฑะฐะณ ะฒ ะพัะธะณะธะฝะฐะปะต**
   - alpha=1 ะฒ ะณะธะฑัะธะดะฐั โ KNN ะธะณะฝะพัะธัะพะฒะฐะปัั!
   - "ะะธะฑัะธะด" ะฑัะป ะฟัะพััะพ PHCF-BPR
   - ะะพัะปะต ะธัะฟัะฐะฒะปะตะฝะธั (alpha=0.5-0.7) โ ัะตะฐะปัะฝะฐั ัะธะฝะตัะณะธั

2. **Recall ัะปัััะธะปัั ะฒ 3 ัะฐะทะฐ**
   - 0.08 โ 0.28 (+246%)
   - ะะพะดะตะปะธ ะฝะฐัะพะดัั ะฝะฐะผะฝะพะณะพ ะฑะพะปััะต ัะตะปะตะฒะฐะฝัะฝัั ัะตัะฒะธัะพะฒ
   - ะัะธัะธัะฝะพ ะดะปั ัะตะบะพะผะตะฝะดะฐัะตะปัะฝัั ัะธััะตะผ!

3. **ะะพะปััะต epochs ะะ ะฒัะตะณะดะฐ ะปัััะต**
   - 20 epochs: nDCG 0.21
   - 50 epochs: nDCG 0.18 (ะฟะตัะตะพะฑััะตะฝะธะต!)
   - ะะฐ sparse ะดะฐะฝะฝัั ะฑััััะพะต ะฟะตัะตะพะฑััะตะฝะธะต

---

## ๐ฏ ะััะธัะตะบัััั ัะพะฟ ะผะพะดะตะปะตะน

### Hybrid-BPR (ฮฑ=0.7) - ะะตัะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ

```
Input: User-Item interactions (190 ร 120, sparse 99.5%)
                    โ
        โโโโโโโโโโโโโโโโโโโโโโโโโ
        โ   DATA PREPARATION    โ
        โโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ                                       โ
    โผ                                       โผ
โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ
โ  PHCF-BPR (70%)     โ         โ  Weighted KNN (30%) โ
โโโโโโโโโโโโโโโโโโโโโโโค         โโโโโโโโโโโโโโโโโโโโโโโค
โ User Embedding      โ         โ Find 5 neighbors    โ
โ   190 ร 60          โ         โ   Cosine similarity โ
โ                     โ         โ                     โ
โ Item Embedding      โ         โ Inverse dist weight:โ
โ   120 ร 60          โ         โ   w = 1/distance    โ
โ                     โ         โ                     โ
โ BPR Loss:           โ         โ Weighted average:   โ
โ  -log(ฯ(s+ - s-))   โ         โ   ฮฃ(w_i ร user_i)   โ
โ                     โ         โ                     โ
โ Prediction:         โ         โ Prediction:         โ
โ   uยทi scores        โ         โ   weighted avg      โ
โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโ
           โ                               โ
           โโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
                          โผ
              Combine: 0.7ยทPHCF + 0.3ยทKNN
                          โ
                  Mask used items
                          โ
                  Top-k selection
                          โ
          Output: Ranked recommendations
```

**ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ:**
- **BPR loss**: ะพะฟัะธะผะธะทะธััะตั pairwise ranking
- **60 ะบะพะผะฟะพะฝะตะฝั**: ะพะฟัะธะผัะผ ะดะปั 120 ัะตัะฒะธัะพะฒ
- **Weighted KNN**: inverse distance weighting
- **Cosine metric**: ะปัััะต ะดะปั sparse CF
- **alpha=0.7**: ะพะฟัะธะผะฐะปัะฝัะน ะฑะฐะปะฐะฝั

**ะะตะทัะปััะฐั:** nDCG **0.2048** (+28% vs baseline)

---

## ๐ ะะฝัะตัะฟัะตัะฐัะธั ัะตะทัะปััะฐัะพะฒ

### ะะพัะตะผั ะฒััะพะบะธะน Accuracy (~91%), ะฝะพ ะฝะธะทะบะธะน Precision (~7%)?

**Sparse ะดะฐะฝะฝัะต (99.5% ัะฐะทัะตะถะตะฝะฝะพััั):**

```
ะะฐััะธัะฐ: 190 ร 120 = 22,800 ะฒะพะทะผะพะถะฝัั ะฟะฐั
ะคะฐะบัะธัะตัะบะธั: ~11,428 ะฒะทะฐะธะผะพะดะตะนััะฒะธะน
โ ะะฐะทัะตะถะตะฝะฝะพััั: 99.5%

Accuracy ััะธัะฐะตััั ะดะปั ะะกะะฅ ะฟะฐั:
  True Negatives: ~22,740 (ะฟัะฐะฒะธะปัะฝัะต "ะฝะต ัะตะบะพะผะตะฝะดะพะฒะฐัั") โ 99.7%
  True Positives: ~60 (ะฟัะฐะฒะธะปัะฝัะต ัะตะบะพะผะตะฝะดะฐัะธะธ)
  
ะะพััะพะผั:
  โ Accuracy ะฒััะพะบะธะน (~91%) - ะผะฝะพะณะพ ะฟัะฐะฒะธะปัะฝัั negative
  โ๏ธ Precision ะฝะธะทะบะธะน (~7%) - ัะปะพะถะฝะพ ัะณะฐะดะฐัั positive ะธะท 22,800 ะฟะฐั
```

**ะัะฒะพะด:** ะะปั sparse ะดะฐะฝะฝัั **Precision, Recall ะธ nDCG** ะฒะฐะถะฝะตะต Accuracy!

---

### ะงัะพ ะพะทะฝะฐัะฐัั ะผะตััะธะบะธ?

**Precision@k:**
```
Precision = |Recommended โฉ Relevant| / k
ะกะบะพะปัะบะพ ะธะท ัะพะฟ-k ัะตะบะพะผะตะฝะดะฐัะธะน ะพะบะฐะทะฐะปะธัั ัะตะปะตะฒะฐะฝัะฝัะผะธ

0.0708 = 7.08% ัะตะบะพะผะตะฝะดะฐัะธะน ะฟัะฐะฒะธะปัะฝัะต
ะะปั k=10: ~0.7 ะฟัะฐะฒะธะปัะฝัั ะธะท 10
```

**Recall@k:**
```
Recall = |Recommended โฉ Relevant| / |Relevant|
ะะฐะบัั ะดะพะปั ัะตะปะตะฒะฐะฝัะฝัั ัะตัะฒะธัะพะฒ ะผั ะฝะฐัะปะธ

0.2807 = ะฝะฐัะพะดะธะผ 28% ะฒัะตั ัะตะปะตะฒะฐะฝัะฝัั ัะตัะฒะธัะพะฒ
ะัะปะพ 0.08 = 8% โ ะฃะะฃะงะจะะะะ ะ 3 ะะะะ!
```

**nDCG@k:**
```
ะะฐัะตััะฒะพ ัะฐะฝะถะธัะพะฒะฐะฝะธั ั ััะตัะพะผ ะฟะพะทะธัะธะธ
ะะตัะฒัะต ะฟะพะทะธัะธะธ ะฒะฐะถะฝะตะต ะฟะพัะปะตะดะฝะธั

0.2048 = ัะพัะพัะตะต ัะฐะฝะถะธัะพะฒะฐะฝะธะต
ะะฐ sparse ะดะฐะฝะฝัั (99.5%) ััะพ ะพัะปะธัะฝัะน ัะตะทัะปััะฐั!
```

---

## ๐ FAQ

**Q: ะะฐะบัั ะผะพะดะตะปั ะธัะฟะพะปัะทะพะฒะฐัั?**  
A: **Hybrid-BPR (ฮฑ=0.7)** - ะปัััะธะน nDCG (0.2048) ะธ ะฑะฐะปะฐะฝั ะผะตััะธะบ.

**Q: ะะฐะบ ัะปัััะธัั ัะตะทัะปััะฐัั?**  
A: 
1. ะัะฟะพะปัะทัะนัะต seed=1000 (ะปัััะธะน seed)
2. ะะทะผะตะฝะธัะต `RANDOM_SEED = 1000` ะฒ ัะฐะนะปะต
3. ะฃะฒะตะปะธัััะต ะดะฐัะฐัะตั (100k+ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน)

**Q: ะะพัะตะผั Precision ัะฐะบะพะน ะฝะธะทะบะธะน (~7%)?**  
A: ะะฐะฝะฝัะต ะพัะตะฝั ัะฐะทัะตะถะตะฝะฝัะต (99.5%). ะญัะพ ะฝะพัะผะฐะปัะฝะพ ะดะปั implicit feedback. Precision 7-8% - ัะพัะพัะธะน ัะตะทัะปััะฐั!

**Q: ะะฐัะตะผ ะฝัะถะตะฝ ะณะธะฑัะธะด?**  
A: PHCF-BPR ะฝะฐัะพะดะธั ะณะปะพะฑะฐะปัะฝัะต ะฟะฐััะตัะฝั, KNN - ะปะพะบะฐะปัะฝัะต. ะะพะผะฑะธะฝะฐัะธั ะดะฐะตั ะปัััะธะน ัะตะทัะปััะฐั!

**Q: ะงัะพ ัะฐะบะพะต alpha?**  
A: ะะตั ะผะตะถะดั ะผะพะดะตะปัะผะธ. alpha=0.7 โ 70% PHCF + 30% KNN.

**Q: ะะพัะตะผั ัะตะทัะปััะฐัั ะผะตะฝััััั ั seed?**  
A: Sparse ะดะฐะฝะฝัะต (99.5%) โ ะฒััะพะบะฐั ััะฒััะฒะธัะตะปัะฝะพััั ะบ ะธะฝะธัะธะฐะปะธะทะฐัะธะธ. ะะฐัะธะฐัะธั ยฑ16%.

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
collaborative filtering/
โโโ README.md                            - ะญัะฐ ะดะพะบัะผะตะฝัะฐัะธั
โโโ collaborative_filtering_comparison.py - ะะพะด ััะฐะฒะฝะตะฝะธั (12 ะผะพะดะตะปะตะน)
โโโ calls.csv                            - ะะฐะฝะฝัะต (735K)
โโโ cf_metrics_comparison.png            - ะะธะทัะฐะปะธะทะฐัะธั ะผะตััะธะบ
โโโ cf_grouped_metrics.png               - Grouped bar chart
โโโ cf_heatmap.png                       - ะขะตะฟะปะพะฒะฐั ะบะฐััะฐ
โโโ cf_radar_chart.png                   - Radar chart
```

---

## โจ ะัะพะณะพะฒะฐั ัะฒะพะดะบะฐ

### ๐ ะัััะธะต ะผะพะดะตะปะธ:

1. **Hybrid-BPR (ฮฑ=0.7)** - nDCG 0.2048 ๐ฅ
2. **PHCF-BPR (OPTIMIZED)** - nDCG 0.1911 ๐ฅ
3. **Hybrid-BPR (OPTIMIZED)** - Recall 0.2807 ๐ฅ

### ๐ ะัะพะณัะตัั ะพะฟัะธะผะธะทะฐัะธะธ:

```
0.1599 (ะพัะธะณะธะฝะฐะป PHCF-BPR)
  โ +9%
0.1746 (ัะฒะตะปะธัะตะฝั epochs/comp)
  โ +14%
0.1816 (ะธัะฟัะฐะฒะปะตะฝ alpha ะฒ ะณะธะฑัะธะดะต)
  โ +22%
0.1953 (ะปัััะธะน seed=1000)
  โ +28%
0.2048 (Hybrid-BPR ฮฑ=0.7) ๐ฅ
```

**ะะฑัะตะต ัะปัััะตะฝะธะต:** +28% nDCG!

### ๐ฏ ะะปััะตะฒัะต ัะปัััะตะฝะธั:

- โ ะัะฟัะฐะฒะปะตะฝ alpha (1.0 โ 0.5-0.7)
- โ ะะฟัะธะผะธะทะธัะพะฒะฐะฝั ะฟะฐัะฐะผะตััั (Grid Search)
- โ Recall ัะปัััะธะปัั ะฒ 3 ัะฐะทะฐ
- โ nDCG ัะฒะตะปะธัะตะฝ ะฝะฐ 28%

---

**ะะพะผะฐะฝะดะฐ ะดะปั ะทะฐะฟััะบะฐ:**
```bash
cd "collaborative filtering"
python3 collaborative_filtering_comparison.py
```

**ะัััะธะน ัะตะทัะปััะฐั:** Hybrid-BPR (ฮฑ=0.7) - nDCG **0.2048** ๐

**ะะปั ะผะฐะบัะธะผะฐะปัะฝะพะณะพ ัะตะทัะปััะฐัะฐ:** ะะทะผะตะฝะธัะต `RANDOM_SEED = 1000` ะฒ ัะฐะนะปะต

---

**ะะตััะธั:** 2.0 Final (Optimized)  
**ะะฐัะฐ:** October 13, 2025  
**ะะพะดะตะปะตะน:** 12  
**ะกัะฐััั:** โ Production Ready

๐ **ะัะพะตะบั ะณะพัะพะฒ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!** ๐

