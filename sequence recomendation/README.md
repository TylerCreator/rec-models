# üéØ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –Ω–∞ DAG-–≥—Ä–∞—Ñ–∞—Ö

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–∑–æ–≤–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥—Ä–∞—Ñ–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π (DAG - Directed Acyclic Graph).

**–í–µ—Ä—Å–∏—è:** 4.2 (Optimized)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
**–õ—É—á—à–∞—è –º–æ–¥–µ–ª—å:** Personalized DAGNN (Accuracy: 55.26%, nDCG: 77.96%)

## ‚ú® –ù–û–í–û–ï: –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è

–¢–µ–ø–µ—Ä—å –≤—Å–µ –º–æ–¥–µ–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç **k-fold –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—é** –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!

**–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
```bash
# –ó–∞–ø—É—Å–∫ —Å 5-fold cross-validation
./run_cross_validation.sh compositionsDAG.json 5 200

# –ò–ª–∏ –±—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3 —Ñ–æ–ª–¥–∞, 100 —ç–ø–æ—Ö)
./run_quick_cv.sh compositionsDAG.json
```

**–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:**
```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º (train/test split)
python sequence_dag_recommender_final.py --data compositionsDAG.json

# –ö—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è (5 —Ñ–æ–ª–¥–æ–≤)
python sequence_dag_recommender_final.py --data compositionsDAG.json --use-cv --cv-folds 5
```

üìñ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** [CROSS_VALIDATION_GUIDE.md](CROSS_VALIDATION_GUIDE.md)

---

## üìä –î–∞–Ω–Ω—ã–µ

### –ò—Å—Ç–æ—á–Ω–∏–∫: `compositionsDAG.json`

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- 943 –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- 50 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ (15 —Å–µ—Ä–≤–∏—Å–æ–≤ + 35 —Ç–∞–±–ª–∏—Ü)
- 106 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π (–∏–∑–≤–ª–µ—á–µ–Ω—ã –∏–∑ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π)
- **125 –æ–±—É—á–∞—é—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤** (87 train / 38 test)
- **15 —Ü–µ–ª–µ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤** (—Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å—ã)
- 4 —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –ø–æ–ª—è `owner`)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥—Ä–∞—Ñ–∞:**
```
50 —É–∑–ª–æ–≤:
  ‚îú‚îÄ 15 —Å–µ—Ä–≤–∏—Å–æ–≤ (service_XXX) - —Ü–µ–ª–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã
  ‚îî‚îÄ 35 —Ç–∞–±–ª–∏—Ü (table_XXX) - –≤—Ö–æ–¥–Ω—ã–µ —É–∑–ª—ã

97 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–µ–±–µ—Ä:
  ‚îú‚îÄ table ‚Üí service (90.7%)
  ‚îî‚îÄ service ‚Üí service (9.3%)
```

---

## üèÜ –ò–¢–û–ì–û–í–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –í–°–ï–• –ú–û–î–ï–õ–ï–ô

### –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (200 —ç–ø–æ—Ö, –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

| –†–∞–Ω–≥ | –ú–æ–¥–µ–ª—å | Type | nDCG | Accuracy | Unique Preds | –í—Ä–µ–º—è |
|------|--------|------|------|----------|--------------|-------|
| ü•á **#1** | **DAGNN-Improved** | GNN | **0.6814** üèÜ | 0.4737 | 2/12 ‚ö†Ô∏è | ~1.2s |
| ü•à **#2** | **DAGNNSequential** | Hybrid | **0.6800** | 0.4737 | 2/12 ‚ö†Ô∏è | ~1.3s |
| ü•â **#3** | **GRU4Rec** | Sequential | **0.6797** | 0.4737 | 2/12 ‚ö†Ô∏è | ~1.7s |
| #4 | DAGNN | GNN | 0.6754 | 0.4737 | 2/12 ‚ö†Ô∏è | ~0.8s |
| #5 | GCN | GNN | 0.6690 | 0.4737 | 2/12 ‚ö†Ô∏è | ~0.8s |
| #6 | DAGNNAttention | Hybrid | 0.6676 | 0.4737 | 2/12 ‚ö†Ô∏è | ~2.6s |
| #7 | GraphSAGE | GNN | 0.6667 | 0.4737 | 2/12 ‚ö†Ô∏è | ~0.5s |
| #8 | SASRec | Sequential | 0.6021 | 0.3421 | **9/12** ‚úÖ | ~3.9s |
| #9 | Caser | Sequential | 0.5928 | 0.3158 | **12/12** ‚úÖ | ~1.9s |
| #10 | Random Forest | ML Baseline | 0.5895 | 0.3684 | 3-4/12 | ~0.3s |
| #11 | Popularity | Baseline | 0.5877 | 0.3684 | 1/12 | <0.01s |

**–° –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π (v4.1):**
| üåü | **Personalized DAGNN** | GNN+User | **0.7796** üî• | **0.5526** | - | ~1.5s |

‚ö†Ô∏è Mode Collapse: 7 –∏–∑ 11 –º–æ–¥–µ–ª–µ–π –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ 2 –∫–ª–∞—Å—Å–∞ –∏–∑ 12

---

## üî¨ –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 1: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã—Ö–æ–¥–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤

**–í–æ–ø—Ä–æ—Å:** –°–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–æ–≤ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –º–æ–¥–µ–ª—å?

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å:**
- **50 –∫–ª–∞—Å—Å–æ–≤** (–≤—Å–µ —É–∑–ª—ã: 15 —Å–µ—Ä–≤–∏—Å–æ–≤ + 35 —Ç–∞–±–ª–∏—Ü)
- **15 –∫–ª–∞—Å—Å–æ–≤** (—Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å—ã - —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

| –ú–æ–¥–µ–ª—å | 50 –∫–ª–∞—Å—Å–æ–≤ | 15 –∫–ª–∞—Å—Å–æ–≤ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|--------|------------|------------|-----------|
| GCN | 0.6618 | **0.6690** | ‚¨ÜÔ∏è +1.1% |
| DAGNN | 0.6782 | 0.6754 | ‚¨áÔ∏è -0.4% |
| DAGNN-Improved | 0.6895 | 0.6814 | ‚¨áÔ∏è -1.2% |
| GRU4Rec | 0.6790 | 0.6797 | ‚¨ÜÔ∏è +0.1% |
| Sequential –º–æ–¥–µ–ª–∏ | - | - | 0.0% |

**–í—ã–≤–æ–¥—ã:**
- ‚úÖ **15 –∫–ª–∞—Å—Å–æ–≤ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (¬±1%)
- ‚úÖ –ú–µ–Ω—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (64‚Üí15 –≤–º–µ—Å—Ç–æ 64‚Üí50)
- ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 15 –∫–ª–∞—Å—Å–æ–≤**

---

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 2: –°–∏–º–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –∏ self-loops

**–í–æ–ø—Ä–æ—Å:** –ù—É–∂–Ω–æ –ª–∏ —Å–∏–º–º–µ—Ç—Ä–∏–∑–æ–≤–∞—Ç—å DAG –≥—Ä–∞—Ñ –¥–ª—è GCN –∏ –¥–æ–±–∞–≤–ª—è—Ç—å self-loops?

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å:**
1. **–û—Ä–∏–≥–∏–Ω–∞–ª:** –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ, 97 —Ä–µ–±–µ—Ä, –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π
2. **–° —Å–∏–º–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π:** to_undirected() –¥–ª—è GCN ‚Üí 194 —Ä–µ–±—Ä–∞
3. **–° self-loops:** add_self_loops() ‚Üí +50 —Å–∞–º–æ–ø–µ—Ç–µ–ª—å

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã (15 –∫–ª–∞—Å—Å–æ–≤):**

| –ú–æ–¥–µ–ª—å | –û—Ä–∏–≥–∏–Ω–∞–ª (97) | +Self-loops (147) | +–°–∏–º–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è (244) | –õ—É—á—à–∞—è |
|--------|---------------|-------------------|---------------------|--------|
| **GCN** | **0.6690** ‚úÖ | - | 0.6154 ‚¨áÔ∏è | **–û—Ä–∏–≥–∏–Ω–∞–ª** |
| **DAGNN** | **0.6754** ‚úÖ | 0.6418 ‚¨áÔ∏è | - | **–û—Ä–∏–≥–∏–Ω–∞–ª** |
| **DAGNN-Improved** | **0.6814** ‚úÖ | 0.6325 ‚¨áÔ∏è | - | **–û—Ä–∏–≥–∏–Ω–∞–ª** |
| **GraphSAGE** | 0.6667 | 0.6676 ‚¨ÜÔ∏è | - | Self-loops |
| **DAGNNSequential** | **0.6800** = | 0.6800 = | - | **–ë–µ–∑ —Ä–∞–∑–Ω–∏—Ü—ã** |

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- GCN —Å —Å–∏–º–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π: **-5.36%** ‚¨áÔ∏è‚¨áÔ∏è (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —É—Ö—É–¥—à–µ–Ω–∏–µ!)
- DAGNN —Å self-loops: **-3.36%** ‚¨áÔ∏è
- DAGNN-Improved —Å self-loops: **-4.89%** ‚¨áÔ∏è

**–í—ã–≤–æ–¥—ã:**
- ‚ùå **–°–∏–º–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –í–†–ï–î–ù–ê** –¥–ª—è DAG —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚ùå **Self-loops –í–†–ï–î–ù–´** –Ω–∞ –º–∞–ª–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ (125 –ø—Ä–∏–º–µ—Ä–æ–≤)
- ‚úÖ **–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ –ë–ï–ó –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π - –æ–ø—Ç–∏–º–∞–ª–µ–Ω**

**–ü—Ä–∏—á–∏–Ω—ã —É—Ö—É–¥—à–µ–Ω–∏—è:**

1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ DAG —Å–µ–º–∞–Ω—Ç–∏–∫–∏:**
   ```
   –ü—Ä–∞–≤–∏–ª—å–Ω–æ:  table ‚Üí service‚ÇÅ ‚Üí service‚ÇÇ  (–ø—Ä–∏—á–∏–Ω–∞ ‚Üí —Å–ª–µ–¥—Å—Ç–≤–∏–µ)
   –ü–æ—Å–ª–µ:      table ‚Üî service‚ÇÅ ‚Üî service‚ÇÇ  (—Ç–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
   ```

2. **–ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –º–∞–ª–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ:**
   ```
   125 –ø—Ä–∏–º–µ—Ä–æ–≤ √∑ 244 —Ä–µ–±—Ä–∞ = 0.51 –ø—Ä–∏–º–µ—Ä–∞ –Ω–∞ —Ä–µ–±—Ä–æ
   –°–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Å–≤—è–∑–µ–π
   ```

3. **Self-loops —É—Å–∏–ª–∏–≤–∞—é—Ç –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ:**
   ```
   +50 —Å–∞–º–æ–ø–µ—Ç–µ–ª—å = +50% –±–æ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   –£–∑–ª—ã "–∑–∞—Ü–∏–∫–ª–∏–≤–∞—é—Ç—Å—è" –Ω–∞ —Å–≤–æ–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö
   –•—É–∂–µ –≥–µ–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏—è
   ```

---

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 3: –ì—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫–∏

**–í–æ–ø—Ä–æ—Å:** –ü–æ–º–æ–≥–∞—é—Ç –ª–∏ –≥—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (PageRank, Betweenness, Clustering) —É–ª—É—á—à–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏?

**–ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (2 —Ñ–∏—á–∏):**
- is_service (–±–∏–Ω–∞—Ä–Ω—ã–π)
- is_table (–±–∏–Ω–∞—Ä–Ω—ã–π)

**–ì—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (+16 —Ñ–∏—á–µ–π):**
- PageRank
- Betweenness Centrality
- Clustering Coefficient
- In-degree / Out-degree
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å–æ—Å–µ–¥–µ–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ü—Ä–∏–∑–Ω–∞–∫–æ–≤ | DAGNN nDCG | –£–ª—É—á—à–µ–Ω–∏–µ |
|--------------|-----------|------------|-----------|
| **–¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ** | 2 | **0.6754** ‚úÖ | –ë–∞–∑–æ–≤–∞—è |
| –° –≥—Ä–∞—Ñ–æ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ | 2 + 16 = 18 | 0.6418 ‚¨áÔ∏è | **-3.36%** |

**–í—ã–≤–æ–¥—ã:**
- ‚ùå **–ì—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –£–•–£–î–®–ò–õ–ò —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ 3.36%**
- ‚úÖ **–ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (2) —Ä–∞–±–æ—Ç–∞—é—Ç –õ–£–ß–®–ï —Å–ª–æ–∂–Ω—ã—Ö (18)**
- ‚ùå –ë–æ–ª—å—à–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ ‚â† –ª—É—á—à–µ –∫–∞—á–µ—Å—Ç–≤–æ (–Ω–∞ –º–∞–ª–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ)

**–ü–æ—á–µ–º—É –≥—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ –ø–æ–º–æ–≥–ª–∏:**

1. **–ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ:**
   ```
   125 –ø—Ä–∏–º–µ—Ä–æ–≤ √ó 18 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ = —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö
   –ú–æ–¥–µ–ª—å –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—É—é –≤—ã–±–æ—Ä–∫—É
   –ü–ª–æ—Ö–æ –æ–±–æ–±—â–∞–µ—Ç –Ω–∞ —Ç–µ—Å—Ç
   ```

2. **–£—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:**
   ```
   PageRank —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ –≤—Å–µ–º—É –≥—Ä–∞—Ñ—É
   –í–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ test —É–∑–ª–∞—Ö
   –ú–æ–¥–µ–ª—å –º–æ–∂–µ—Ç "–ø–æ–¥—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å"
   ```

3. **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å:**
   ```
   DAGNN —Å–∞–º –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≥—Ä–∞—Ñ–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ propagation
   –Ø–≤–Ω—ã–µ –≥—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥—É–±–ª–∏—Ä—É—é—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
   Redundancy ‚Üí –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
   ```

4. **–®—É–º:**
   ```
   –ù–∞ –º–∞–ª–æ–º –≥—Ä–∞—Ñ–µ (50 —É–∑–ª–æ–≤) –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã
   –í—ã—Å–æ–∫–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
   –°–∏–≥–Ω–∞–ª < –®—É–º
   ```

---

## üåü –ü–æ—á–µ–º—É Personalized DAGNN –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –õ–£–ß–®–ï –≤—Å–µ—Ö?

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Personalized DAGNN

```python
class PersonalizedDAGNN:
    # 1. Node embeddings (–≥—Ä–∞—Ñ)
    node_emb = DAGNN(x, edge_index)  # [50, hidden]
    
    # 2. User embeddings (–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è)
    user_emb = nn.Embedding(num_users, hidden)  # [4, hidden]
    
    # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è
    combined = node_emb[context] + user_emb[user_id]
    
    # 4. Prediction
    output = Classifier(combined)  # [batch, 15]
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

| –ú–æ–¥–µ–ª—å | nDCG | Accuracy | –£–ª—É—á—à–µ–Ω–∏–µ vs DAGNN |
|--------|------|----------|-------------------|
| **Personalized DAGNN** | **0.7796** üî• | **0.5526** | **+15.4%** |
| DAGNN-Improved | 0.6814 | 0.4737 | baseline |
| DAGNNSequential | 0.6800 | 0.4737 | baseline |

### –ü–æ—á–µ–º—É Personalized DAGNN –ª—É—á—à–µ?

#### 1Ô∏è‚É£ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–∞–∂–Ω—ã–π —Å–∏–≥–Ω–∞–ª

**–ü—Ä–æ–±–ª–µ–º–∞ –±–∞–∑–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π:**
```
–ö–æ–Ω—Ç–µ–∫—Å—Ç: (table_X, service_308)
–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ

–ù–æ —Ä–µ–∞–ª—å–Ω–æ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç service_309
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å B —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç service_312
```

**–†–µ—à–µ–Ω–∏–µ Personalized DAGNN:**
```python
# –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
prediction = f(context, user_preferences)

User A: (table_X, service_308) + user_A_emb ‚Üí service_309 ‚úÖ
User B: (table_X, service_308) + user_B_emb ‚Üí service_312 ‚úÖ
```

#### 2Ô∏è‚É£ –ë–æ–ª—å—à–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è—Ö

**–ë–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (–±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏):**
```
Unique predictions: 2/12 –∫–ª–∞—Å—Å–æ–≤
service_308: 79%
service_309: 21%
‚Üí Mode collapse! ‚ö†Ô∏è
```

**Personalized DAGNN:**
```
–£—á–∏—Ç—ã–≤–∞–µ—Ç:
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
- –ì—Ä–∞—Ñ–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
‚Üí –ë–æ–ª–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è ‚úÖ
```

#### 3Ô∏è‚É£ –õ—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞–ª–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

**4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –¥–∞–Ω–Ω—ã—Ö:**
```python
user_embedding = nn.Embedding(4, hidden_dim)
# –¢–æ–ª—å–∫–æ 4 √ó hidden_dim –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
# –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:**
```
–í–º–µ—Å—Ç–æ: "–∫–∞–∫–æ–π —Å–ª–µ–¥—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å –≤ —Å—Ä–µ–¥–Ω–µ–º?"
–ú–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è: "–∫–∞–∫–æ–π —Å–ª–µ–¥—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –≠–¢–û–ì–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?"
```

#### 4Ô∏è‚É£ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  DAGNN: –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≥—Ä–∞—Ñ–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã    ‚îÇ
‚îÇ         (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–∑–∏—Ü–∏–π)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 +
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User Embedding: –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è          ‚îÇ
‚îÇ                  –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 =
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏      ‚îÇ
‚îÇ  —Å —É—á–µ—Ç–æ–º –≥—Ä–∞—Ñ–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### –ü–æ —Ç–∏–ø–∞–º –º–æ–¥–µ–ª–µ–π

#### üî∑ GNN –º–æ–¥–µ–ª–∏ (—Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥—Ä–∞—Ñ–∞)

| –ú–æ–¥–µ–ª—å | nDCG | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|------|-------------|
| DAGNN-Improved | **0.6814** | Focal Loss + Label Smoothing |
| DAGNN | 0.6754 | APPNP propagation (10 hops) |
| GCN | 0.6690 | 3 —Å–ª–æ—è GCNConv |
| GraphSAGE | 0.6667 | Mean/Max aggregation |

**–í—ã–≤–æ–¥—ã:**
- –õ—É—á—à–∞—è: DAGNN-Improved (Focal Loss –ø–æ–º–æ–≥–∞–µ—Ç —Å –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é)
- DAGNN —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å DAG —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- GCN –ø—Ä–∏–µ–º–ª–µ–º–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º –≥—Ä–∞—Ñ–µ

#### üî∂ Hybrid –º–æ–¥–µ–ª–∏ (–≥—Ä–∞—Ñ + –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

| –ú–æ–¥–µ–ª—å | nDCG | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|------|-------------|
| DAGNNSequential | **0.6800** | DAGNN + GRU (2 layers) |
| DAGNNAttention | 0.6676 | DAGNN + Self-Attention (4 heads) |

**–í—ã–≤–æ–¥—ã:**
- –ì–∏–±—Ä–∏–¥–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ö–æ—Ä–æ—à–æ
- GRU –ª—É—á—à–µ Attention –Ω–∞ –º–∞–ª–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ
- –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–∑–Ω–∞

#### üîπ Sequential –º–æ–¥–µ–ª–∏ (—Ç–æ–ª—å–∫–æ –ø–æ—Ä—è–¥–æ–∫)

| –ú–æ–¥–µ–ª—å | nDCG | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|------|-------------|
| GRU4Rec | **0.6797** | 2-layer GRU, –ª—É—á—à–∏–π —Å—Ä–µ–¥–∏ sequential |
| SASRec | 0.6021 | Self-Attention, 9/12 –∫–ª–∞—Å—Å–æ–≤ ‚úÖ |
| Caser | 0.5928 | CNN (H+V filters), 12/12 –∫–ª–∞—Å—Å–æ–≤ ‚úÖ |

**–í—ã–≤–æ–¥—ã:**
- GRU4Rec –∫–æ–Ω–∫—É—Ä–∏—Ä—É–µ—Ç —Å GNN –º–æ–¥–µ–ª—è–º–∏!
- SASRec –∏ Caser –∏–∑–±–µ–≥–∞—é—Ç mode collapse
- –ú–µ–Ω—å—à–µ accuracy, –Ω–æ –±–æ–ª—å—à–µ diversity

#### üî∏ Baseline –º–æ–¥–µ–ª–∏ (—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π ML)

| –ú–æ–¥–µ–ª—å | nDCG | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|------|-------------|
| Random Forest | 0.5895 | 200 –¥–µ—Ä–µ–≤—å–µ–≤, max_depth=15, 3-4/12 –∫–ª–∞—Å—Å–æ–≤ |
| Popularity | 0.5877 | –í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø-1 –∫–ª–∞—Å—Å |

**–í—ã–≤–æ–¥—ã:**
- Random Forest –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç Popularity baseline
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–æ–ª—å—à–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π (3-4 –∫–ª–∞—Å—Å–∞)
- –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ (~0.3s), —Ö–æ—Ä–æ—à–æ –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –£—Å—Ç—É–ø–∞–µ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤—ã–º –º–æ–¥–µ–ª—è–º –Ω–∞ ~10% –ø–æ nDCG

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã Mode Collapse

### –ß—Ç–æ —Ç–∞–∫–æ–µ Mode Collapse?

**7 –∏–∑ 11 –º–æ–¥–µ–ª–µ–π –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ 2 –∫–ª–∞—Å—Å–∞:**
```
–ö–ª–∞—Å—Å 2 (service_308): 30 —Ä–∞–∑ (79%)
–ö–ª–∞—Å—Å 3 (service_309): 8 —Ä–∞–∑ (21%)
–û—Å—Ç–∞–ª—å–Ω—ã–µ 10 –∫–ª–∞—Å—Å–æ–≤: 0 —Ä–∞–∑ ‚ùå
```

### –ü–æ—á–µ–º—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

1. **–ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
   ```
   service_308: 40 –ø—Ä–∏–º–µ—Ä–æ–≤ (32%) - —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π
   service_397: 1 –ø—Ä–∏–º–µ—Ä (0.8%) - —Å–∞–º—ã–π —Ä–µ–¥–∫–∏–π
   ```

2. **–ú–∞–ª—ã–π –¥–∞—Ç–∞—Å–µ—Ç (125 –ø—Ä–∏–º–µ—Ä–æ–≤):**
   ```
   –ú–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è "–ª–µ–≥–∫–æ–º—É —Ä–µ—à–µ–Ω–∏—é"
   ‚Üí –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–ª–∞—Å—Å—ã
   ‚Üí –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–¥–∫–∏–µ –∫–ª–∞—Å—Å—ã
   ```

3. **–í—ã—Å–æ–∫–∞—è accuracy –æ–±–º–∞–Ω—á–∏–≤–∞:**
   ```
   Accuracy = 47.37% –ø—Ä–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–∏ —Ç–æ–ª—å–∫–æ 2 –∫–ª–∞—Å—Å–æ–≤!
   
   –ö–∞–∫? 
   - service_308 –≤ —Ç–µ—Å—Ç–µ: 14 —Ä–∞–∑ ‚Üí —É–≥–∞–¥–∞–ª–∏ –≤—Å–µ 14
   - service_309 –≤ —Ç–µ—Å—Ç–µ: 4 —Ä–∞–∑–∞ ‚Üí —É–≥–∞–¥–∞–ª–∏ –≤—Å–µ 4
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ: 0 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö
   
   Total: (14 + 4) / 38 = 47.37% ‚úÖ
   –ù–æ diversity = 0! ‚ùå
   ```

### –ö—Ç–æ –∏–∑–±–µ–∂–∞–ª Mode Collapse?

**‚úÖ SASRec (9/12 –∫–ª–∞—Å—Å–æ–≤):**
- Transformer architecture
- Self-Attention –º–µ—Ö–∞–Ω–∏–∑–º
- –ë–æ–ª—å—à–µ capacity –¥–ª—è —Ä–µ–¥–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤

**‚úÖ Caser (12/12 –∫–ª–∞—Å—Å–æ–≤ - –í–°–ï!):**
- CNN —Å horizontal + vertical filters
- –†–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –æ–∫–æ–Ω (2, 3, 4)
- –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### –ü–æ–ø—ã—Ç–∫–∏ —Ä–µ—à–µ–Ω–∏—è

**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

1. **Focal Loss** (Œ≥=2.0):
   ```
   –§–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ "—Å–ª–æ–∂–Ω—ã—Ö" –ø—Ä–∏–º–µ—Ä–∞—Ö
   –†–µ–∑—É–ª—å—Ç–∞—Ç: -0.81% ‚¨áÔ∏è (–Ω–µ –ø–æ–º–æ–≥–ª–æ)
   ```

2. **Label Smoothing** (Œµ=0.1):
   ```
   –°–≥–ª–∞–∂–∏–≤–∞–µ—Ç one-hot –º–µ—Ç–∫–∏
   –†–µ–∑—É–ª—å—Ç–∞—Ç: -0.81% ‚¨áÔ∏è (–Ω–µ –ø–æ–º–æ–≥–ª–æ)
   ```

3. **Class Weights:**
   ```
   Inverse frequency weighting
   –†–µ–∑—É–ª—å—Ç–∞—Ç: -0.81% ‚¨áÔ∏è (–Ω–µ –ø–æ–º–æ–≥–ª–æ)
   ```

**–í—ã–≤–æ–¥:** Mode collapse - –ø—Ä–æ–±–ª–µ–º–∞ –î–ê–ù–ù–´–•, –Ω–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞. –ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤!

---

## üéØ –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–π–¥–µ–Ω—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ)

```python
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–æ–≤
out_channels = 15  # len(service_map) - —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å—ã ‚úÖ

# –ì—Ä–∞—Ñ
edge_index = torch.tensor([[u, v] for u, v in path_graph.edges]).t()
# 97 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ä–µ–±–µ—Ä
# –ë–ï–ó to_undirected() ‚úÖ
# –ë–ï–ó add_self_loops() ‚úÖ

# –ü—Ä–∏–∑–Ω–∞–∫–∏ —É–∑–ª–æ–≤
x = [[1, 0] if is_service else [0, 1]]  # 2 –ø—Ä–∏–∑–Ω–∞–∫–∞ ‚úÖ
# –ë–ï–ó –≥—Ä–∞—Ñ–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ (PageRank –∏ —Ç.–¥.) ‚úÖ

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è (DAGNN-Improved)
hidden_channels = 128
K = 15  # propagation hops
dropout = 0.5
learning_rate = 0.0005
weight_decay = 5e-4
```

### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫?

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|----------|---------|
| **15 –∫–ª–∞—Å—Å–æ–≤** | len(service_map) | –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ |
| **97 —Ä–µ–±–µ—Ä** | –ë–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π | –ú–µ–Ω—å—à–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è |
| **2 –ø—Ä–∏–∑–Ω–∞–∫–∞** | is_service, is_table | –ü—Ä–æ—â–µ = –ª—É—á—à–µ –Ω–∞ –º–∞–ª–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ |
| **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ** | DAG | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (Personalized DAGNN):

```bash
cd "sequence recomendation"
python3 sequence_dag_recommender_with_real_users.py --epochs 100

# –†–µ–∑—É–ª—å—Ç–∞—Ç: Accuracy 55.26%, nDCG 77.96%
```

### –õ—É—á—à–∏–π –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ (DAGNN-Improved):

```bash
python3 sequence_dag_recommender_final.py --epochs 200 --hidden-channels 64

# –†–µ–∑—É–ª—å—Ç–∞—Ç: Accuracy 47.37%, nDCG 68.14%
```

### –ë—ã—Å—Ç—Ä–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π:

```bash
python3 sequence_dag_recommender_final.py --epochs 50 --hidden-channels 64

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 11 –º–æ–¥–µ–ª–µ–π –∑–∞ ~20 —Å–µ–∫—É–Ω–¥
```

---

## üìÅ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

```
sequence recomendation/
‚îú‚îÄ‚îÄ compositionsDAG.json              # –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (943 –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏)
‚îÇ
‚îú‚îÄ‚îÄ sequence_dag_recommender_final.py # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (11 –º–æ–¥–µ–ª–µ–π)
‚îú‚îÄ‚îÄ sequence_dag_recommender_with_real_users.py  # –° –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π (–õ–£–ß–®–ò–ô!)
‚îú‚îÄ‚îÄ sequence_dag_recommender_with_graph_features.py  # –° –≥—Ä–∞—Ñ–æ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ README.md                         # –≠—Ç–æ—Ç —Ñ–∞–π–ª - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ optimal_config_final.log          # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ improved_graph_comparison.log     # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Å–∏–º–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ final_comparison_15classes.log    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å 15 –∫–ª–∞—Å—Å–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ images/                           # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ complete_comparison.png
‚îÇ   ‚îú‚îÄ‚îÄ accuracy_comparison.png
‚îÇ   ‚îú‚îÄ‚îÄ metrics_heatmap.png
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îî‚îÄ‚îÄ visualize_*.py                    # –°–∫—Ä–∏–ø—Ç—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
```

---

## üìö –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### 1. DAGNN (Directed Acyclic Graph Neural Network)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
Input [50, 2] 
  ‚Üì Encoder (Linear + BatchNorm + ReLU)
[50, 64]
  ‚Üì DAGNN Propagation (APPNP, K=10 hops)
[50, 64]
  ‚Üì Classifier (Linear layers)
[batch, 15] predictions
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- APPNP propagation –¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤
- Attention weights –¥–ª—è —Ä–∞–∑–Ω—ã—Ö hops
- Residual connections

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- K = 10 (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ propagation hops)
- Œ± = 0.1 (teleport probability)
- dropout = 0.4

### 2. DAGNN-Improved (—Å Focal Loss + Label Smoothing) üèÜ

**–û—Ç–ª–∏—á–∏—è –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ DAGNN:**
- **Focal Loss:** –§–æ–∫—É—Å –Ω–∞ "—Å–ª–æ–∂–Ω—ã—Ö" –ø—Ä–∏–º–µ—Ä–∞—Ö (Œ≥=2.0)
- **Label Smoothing:** –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –º–µ—Ç–æ–∫ (Œµ=0.1)
- **Class Weights:** Inverse frequency weighting
- **–ë–æ–ª—å—à–µ capacity:** hidden=128 (vs 64)
- **–ë–æ–ª—å—à–µ hops:** K=15 (vs 10)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –õ—É—á—à–∏–π nDCG —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

### 3. DAGNNSequential (Hybrid: DAGNN + GRU) ü•à

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
DAGNN: –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≥—Ä–∞—Ñ–æ–≤—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤—Å–µ—Ö —É–∑–ª–æ–≤
  ‚Üì
Sequence Embeddings: –ë–µ—Ä–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —É–∑–ª–æ–≤ –∏–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  ‚Üì
GRU: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
  ‚Üì
Prediction: –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –≥—Ä–∞—Ñ–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ø–æ—Ä—è–¥–æ–∫
- –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –•–æ—Ä–æ—à–∞—è –≥–µ–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏—è

### 4. GRU4Rec ü•â

**–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω–∞—è –º–æ–¥–µ–ª—å:**
```
Sequences ‚Üí Embedding ‚Üí GRU (2 layers) ‚Üí FC ‚Üí Prediction
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –•–æ—Ä–æ—à–æ –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- –ö–æ–Ω–∫—É—Ä–∏—Ä—É–µ—Ç —Å GNN –º–æ–¥–µ–ª—è–º–∏!

### 5. Personalized DAGNN üåü (–õ–£–ß–®–ò–ô!)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```python
node_emb = DAGNN(graph)           # [50, hidden] - –≥—Ä–∞—Ñ–æ–≤—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
user_emb = Embedding(users)       # [4, hidden] - —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
context_emb = node_emb[context]   # [batch, hidden] - –∫–æ–Ω—Ç–µ–∫—Å—Ç
combined = context_emb + user_emb[user_id]  # –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
output = Classifier(combined)     # [batch, 15] - –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
```

**–ü–æ—á–µ–º—É –ª—É—á—à–µ:**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (+15.4% nDCG!)
- ‚úÖ –ë–æ–ª—å—à–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
- ‚úÖ –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–ª—ã–π –¥–∞—Ç–∞—Å–µ—Ç
- ‚úÖ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üß™ –ù–∞—É—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã

### 1. –ú–µ–Ω—å—à–µ - –∏–Ω–æ–≥–¥–∞ –ª—É—á—à–µ

**–ù–∞ –º–∞–ª—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö (‚â§200 –ø—Ä–∏–º–µ—Ä–æ–≤):**
- ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (2) > –°–ª–æ–∂–Ω—ã–µ (18)
- ‚úÖ –ú–µ–Ω—å—à–µ —Å–≤—è–∑–µ–π (97) > –ë–æ–ª—å—à–µ (147-244)
- ‚úÖ –ú–µ–Ω—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ > –ë–æ–ª—å—à–µ capacity

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ

**DAG ‚Üí Undirected = –ø–æ—Ç–µ—Ä—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏:**
```
table ‚Üí service‚ÇÅ ‚Üí service‚ÇÇ  (–ø—Ä–∏—á–∏–Ω–∞ ‚Üí —Å–ª–µ–¥—Å—Ç–≤–∏–µ) ‚úÖ
table ‚Üî service‚ÇÅ ‚Üî service‚ÇÇ  (–Ω–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è) ‚ùå
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** -5.36% –¥–ª—è GCN

### 3. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è - –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

**+4 user embeddings ‚Üí +15.4% nDCG!**

–î–∞–∂–µ –Ω–∞ 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à.

### 4. Mode Collapse - –ø—Ä–æ–±–ª–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

**–ù–µ –ø–æ–º–æ–≥–ª–∏:**
- ‚ùå Focal Loss
- ‚ùå Label Smoothing
- ‚ùå Class Weights
- ‚ùå –ë–æ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–ü–æ–º–æ–≥–ª–æ:**
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (—Ä–∞–∑–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ –°–ª–æ–∂–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (SASRec, Caser)

### 5. –¢–µ–æ—Ä–∏—è vs –ü—Ä–∞–∫—Ç–∏–∫–∞

**–¢–µ–æ—Ä–∏—è:**
- GCN –Ω—É–∂–µ–Ω —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –≥—Ä–∞—Ñ
- Self-loops —É–ª—É—á—à–∞—é—Ç –æ–±—É—á–µ–Ω–∏–µ
- –ë–æ–ª—å—à–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ = –ª—É—á—à–µ

**–ü—Ä–∞–∫—Ç–∏–∫–∞ (–Ω–∞ –Ω–∞—à–µ–º –¥–∞—Ç–∞—Å–µ—Ç–µ):**
- GCN –ª—É—á—à–µ –Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º –≥—Ä–∞—Ñ–µ ‚úÖ
- Self-loops –≤—Ä–µ–¥—è—Ç ‚úÖ
- –ú–µ–Ω—å—à–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ = –ª—É—á—à–µ ‚úÖ

**–í—ã–≤–æ–¥:** –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –¥–∞–Ω–Ω—ã—Ö!

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è Production (–≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏):

#### –ï—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö ‚Üí **Personalized DAGNN** üåü
```
nDCG: 0.7796
Accuracy: 0.5526
–¢—Ä–µ–±—É–µ—Ç: user_id –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
```

#### –ï—Å–ª–∏ –ù–ï–¢ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö ‚Üí **DAGNN-Improved** üèÜ
```
nDCG: 0.6814
Accuracy: 0.4737
–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –≥—Ä–∞—Ñ–æ–º –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
```

#### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –†–ê–ó–ù–û–û–ë–†–ê–ó–ò–ï –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π ‚Üí **Caser** ‚úÖ
```
nDCG: 0.5928
Accuracy: 0.3158
Unique predictions: 12/12 –∫–ª–∞—Å—Å–æ–≤ (–í–°–ï!)
```

### –î–ª—è Research:

- **DAGNNSequential** - –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ hybrid –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä
- **GraphSAGE** - –±—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ, —Ö–æ—Ä–æ—à–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **SASRec** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è Transformer –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# ========== –ì–†–ê–§ ==========
# –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π DAG, 97 —Ä–µ–±–µ—Ä
edge_index = torch.tensor([[u, v] for u, v in edges]).t()
# –ë–ï–ó —Å–∏–º–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏, –ë–ï–ó self-loops

# ========== –ü–†–ò–ó–ù–ê–ö–ò ==========
# –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ (2 —Ñ–∏—á–∏)
x = [[1, 0] if is_service else [0, 1]]
# –ë–ï–ó –≥—Ä–∞—Ñ–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ (PageRank, Betweenness, etc)

# ========== –ö–õ–ê–°–°–´ ==========
# –¢–æ–ª—å–∫–æ —Ü–µ–ª–µ–≤—ã–µ (—Å–µ—Ä–≤–∏—Å—ã)
out_channels = 15  # len(service_map)

# ========== –ú–û–î–ï–õ–¨ (DAGNN-Improved) ==========
hidden_channels = 128
K = 15
dropout = 0.5
learning_rate = 0.0005
weight_decay = 5e-4
epochs = 200

# ========== LOSS ==========
# Focal Loss (70%) + Label Smoothing (30%)
focal_loss = FocalLoss(alpha=class_weights, gamma=2.0)
smooth_loss = LabelSmoothingLoss(smoothing=0.1)
loss = 0.7 * focal_loss + 0.3 * smooth_loss
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

### –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –•–æ—Ä–æ—à–æ –¥–ª—è |
|---------|----------|------------|
| **Accuracy** | –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π | –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ |
| **nDCG** | Normalized Discounted Cumulative Gain | –ö–∞—á–µ—Å—Ç–≤–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è üèÜ |
| **F1-score** | –ì–∞—Ä–º–æ–Ω–∏—á–µ—Å–∫–æ–µ —Å—Ä–µ–¥–Ω–µ–µ precision –∏ recall | –ë–∞–ª–∞–Ω—Å |
| **Precision** | –¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π | –ö–∞—á–µ—Å—Ç–≤–æ |
| **Recall** | –ü–æ–ª–Ω–æ—Ç–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π | –ü–æ–∫—Ä—ã—Ç–∏–µ |
| **Unique Predictions** | –°–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–æ | Diversity ‚úÖ |

### –ü–æ—á–µ–º—É nDCG –≤–∞–∂–Ω–µ–µ Accuracy?

**Accuracy –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–º–∞–Ω—á–∏–≤–∞:**
```
–ú–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 2 –∫–ª–∞—Å—Å–∞ ‚Üí Accuracy 47%
–ú–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ 12 –∫–ª–∞—Å—Å–æ–≤ ‚Üí Accuracy 34%

–ù–æ –≤—Ç–æ—Ä–∞—è –º–æ–¥–µ–ª—å –ü–û–õ–ï–ó–ù–ï–ï! (–±–æ–ª—å—à–µ diversity)
```

**nDCG —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
Top-1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: +10 –±–∞–ª–ª–æ–≤
Top-2 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: +5 –±–∞–ª–ª–æ–≤
Top-5 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: +2 –±–∞–ª–ª–∞
```

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

```bash
pip install torch torch-geometric networkx numpy sklearn tqdm
```

### –ó–∞–ø—É—Å–∫:

```bash
# –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å (—Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π)
python3 sequence_dag_recommender_with_real_users.py --epochs 100

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π (–±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏)
python3 sequence_dag_recommender_final.py --epochs 200 --hidden-channels 64

# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
python3 sequence_dag_recommender_final.py --epochs 50
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

```
--epochs          : –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö –æ–±—É—á–µ–Ω–∏—è (default: 100)
--hidden-channels : –†–∞–∑–º–µ—Ä —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–ª–æ—è (default: 64)
--learning-rate   : Learning rate (default: 0.001)
--dropout         : Dropout rate (default: 0.4)
--test-size       : –†–∞–∑–º–µ—Ä test –≤—ã–±–æ—Ä–∫–∏ (default: 0.3)
--random-seed     : Random seed (default: 42)
```

---

## üìà –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

### ‚úÖ –ß—Ç–æ —É–∑–Ω–∞–ª–∏:

1. **DAGNN –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å** –≤ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ (15 –∫–ª–∞—Å—Å–æ–≤)
2. **–û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 15 –∫–ª–∞—Å—Å–æ–≤, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ, –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π**
3. **–ì—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–¥–Ω—ã** –Ω–∞ –º–∞–ª–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ (-3.36%)
4. **–°–∏–º–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –≤—Ä–µ–¥–Ω–∞** –¥–ª—è DAG (-5.36% –¥–ª—è GCN)
5. **Self-loops –≤—Ä–µ–¥–Ω—ã** –Ω–∞ 125 –ø—Ä–∏–º–µ—Ä–∞—Ö (-3-5%)
6. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ö–†–ò–¢–ò–ß–ù–ê** (+15.4% nDCG!)

### üèÜ –õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

```
üåü –° –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π:
   Personalized DAGNN: nDCG = 0.7796, Accuracy = 0.5526

üèÜ –ë–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:
   DAGNN-Improved: nDCG = 0.6814, Accuracy = 0.4737
   DAGNNSequential: nDCG = 0.6800, Accuracy = 0.4737
   GRU4Rec: nDCG = 0.6797, Accuracy = 0.4737
```

### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline:

```
Popularity (baseline): nDCG = 0.5877
DAGNN-Improved:        nDCG = 0.6814 (+15.9% —É–ª—É—á—à–µ–Ω–∏–µ)
Personalized DAGNN:    nDCG = 0.7796 (+32.6% —É–ª—É—á—à–µ–Ω–∏–µ!)
```

---

## üéØ –í—ã–≤–æ–¥—ã

### –î–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏:

1. ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Personalized DAGNN** –µ—Å–ª–∏ –µ—Å—Ç—å user_id
2. ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ DAGNN-Improved** –µ—Å–ª–∏ –Ω–µ—Ç user_id
3. ‚úÖ **15 –∫–ª–∞—Å—Å–æ–≤** (—Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å—ã)
4. ‚úÖ **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ –ë–ï–ó –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π**
5. ‚úÖ **–ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏** (2 —Ñ–∏—á–∏)
6. ‚ö†Ô∏è **Mode collapse** - –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ—à–µ–Ω–∏—è

### –î–ª—è –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á:

**–ï—Å–ª–∏ –±–æ–ª—å—à–æ–π –¥–∞—Ç–∞—Å–µ—Ç (>10K –ø—Ä–∏–º–µ—Ä–æ–≤):**
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å self-loops
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ú–æ–∂–Ω–æ —Å–∏–º–º–µ—Ç—Ä–∏–∑–æ–≤–∞—Ç—å –¥–ª—è GCN

**–ï—Å–ª–∏ –º–∞–ª—ã–π –¥–∞—Ç–∞—Å–µ—Ç (<500 –ø—Ä–∏–º–µ—Ä–æ–≤):**
- –ú–∏–Ω–∏–º—É–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π
- **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞!**

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–î–∞—Ç–∞—Å–µ—Ç:** 943 –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏, 50 —É–∑–ª–æ–≤, 97 —Ä–µ–±–µ—Ä  
**–ó–∞–¥–∞—á–∞:** –ú–Ω–æ–≥–æ–∫–ª–∞—Å—Å–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (15 –∫–ª–∞—Å—Å–æ–≤)  
**–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** nDCG = 0.7796 (Personalized DAGNN)

**–§–∞–π–ª—ã:**
- `sequence_dag_recommender_final.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª
- `sequence_dag_recommender_with_real_users.py` - —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π (–õ–£–ß–®–ò–ô!)
- `optimal_config_final.log` - —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:** —Å–º. –ø–∞–ø–∫—É `images/`

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-10-24*  
*–í–µ—Ä—Å–∏—è: 4.2 (Optimized)*
